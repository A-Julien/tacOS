<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tac0S: code/filesys/filesys.cc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tac0S
   </div>
   <div id="projectbrief">Template Affectional Command Operating System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_050edd66366d13764f98250ef6db77f6.html">code</a></li><li class="navelem"><a class="el" href="dir_8e72e263aa613966cfdc557bf0a05642.html">filesys</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a>  </div>
  <div class="headertitle">
<div class="title">filesys.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Routines to manage the overall operation of the file system.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;copyright.h&quot;</code><br />
<code>#include &quot;<a class="el" href="disk_8h_source.html">disk.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="bitmap_8h_source.html">bitmap.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="directory_8h_source.html">directory.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="filehdr_8h_source.html">filehdr.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="filesys_8h_source.html">filesys.h</a>&quot;</code><br />
<code>#include &quot;stdlib.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:acfabd79a397da2bebf0645af84a9885c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acfabd79a397da2bebf0645af84a9885c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="filesys_8cc.html#acfabd79a397da2bebf0645af84a9885c">FreeMapSector</a>&#160;&#160;&#160;0</td></tr>
<tr class="memdesc:acfabd79a397da2bebf0645af84a9885c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sectors containing the file headers for the bitmap of free sectors, and the directory of files. These file headers are placed in well-known sectors, so that they can be located on boot-up. <br /></td></tr>
<tr class="separator:acfabd79a397da2bebf0645af84a9885c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e8a87bff0b10df73c4c8aebd74cd115"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1e8a87bff0b10df73c4c8aebd74cd115"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DirectorySector</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a1e8a87bff0b10df73c4c8aebd74cd115"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38a724e7fcf2a63b3281f36fac7e1d22"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a38a724e7fcf2a63b3281f36fac7e1d22"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="filesys_8cc.html#a38a724e7fcf2a63b3281f36fac7e1d22">FreeMapFileSize</a>&#160;&#160;&#160;(NumSectors / <a class="el" href="bitmap_8h.html#aa9e2c5933951c57333f06c8dab6db241">BitsInByte</a>)</td></tr>
<tr class="memdesc:a38a724e7fcf2a63b3281f36fac7e1d22"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initial file sizes for the bitmap and directory; until the file system supports extensible files, the directory size sets the maximum number of files that can be loaded onto the disk. <br /></td></tr>
<tr class="separator:a38a724e7fcf2a63b3281f36fac7e1d22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68dc84ed1ccf98eee5190f1a2120079a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a68dc84ed1ccf98eee5190f1a2120079a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NumDirEntries</b>&#160;&#160;&#160;30</td></tr>
<tr class="separator:a68dc84ed1ccf98eee5190f1a2120079a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fa3c2eb16686ae45ae59ff299c933d8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7fa3c2eb16686ae45ae59ff299c933d8"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DirectoryFileSize</b>&#160;&#160;&#160;(sizeof(<a class="el" href="class_directory_entry.html">DirectoryEntry</a>) * NumDirEntries)</td></tr>
<tr class="separator:a7fa3c2eb16686ae45ae59ff299c933d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Routines to manage the overall operation of the file system. </p>
<dl class="section author"><dt>Author</dt><dd>Olivier Hureau, Hugo Feydel , Julien ALaimo Implements routines to map from textual file names to files.</dd></dl>
<p>Each file in the file system has: A file header, stored in a sector on disk (the size of the file header data structure is arranged to be precisely the size of 1 disk sector) A number of data blocks An entry in the file system directory</p>
<p>The file system consists of several data structures: A bitmap of free disk sectors (cf. <a class="el" href="bitmap_8h.html" title="Data structures defining a bitmap. ">bitmap.h</a>) A directory of file names and file headers</p>
<p>Both the bitmap and the directory are represented as normal files. Their file headers are located in specific sectors (sector 0 and sector 1), so that the file system can find them on bootup.</p>
<p>The file system assumes that the bitmap and directory files are kept "open" continuously while Nachos is running.</p>
<p>For those operations (such as Create, Remove) that modify the directory and/or bitmap, if the operation succeeds, the changes are written immediately back to disk (the two files are kept open during all this time). If the operation fails, and we have modified part of the directory and/or bitmap, we simply discard the changed version, without writing it back to disk.</p>
<p>Our implementation at this point has the following restrictions:</p>
<p>there is no synchronization for concurrent accesses files have a fixed size, set when the file is created files cannot be bigger than about 3KB in size there is no hierarchical directory structure, and only a limited number of files can be added to the system there is no attempt to make the system robust to failures (if Nachos exits in the middle of an operation that modifies the file system, it may corrupt the disk)</p>
<p>Copyright (c) 1992-1993 The Regents of the University of California. All rights reserved. See <a class="el" href="copyright_8h_source.html">copyright.h</a> for copyright notice and limitation of liability and disclaimer of warranty provisions. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
