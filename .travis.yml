language: bash
sudo: required

branches:
  only:
    - master

services:
  - docker
  
addons:
  apt:
    packages:
      - doxygen

before_install:
- ls -l
- docker pull jalaimo/nachos-build
- docker run -d -v $(pwd):/tacos --name guacamole jalaimo/nachos-build bash -c 'tail -f /dev/null'
- docker ps -a

script:
  - docker exec -it guacamole bash -c 'cd /tacos/code && make > /tacos/test'
  - docker exec -it guacamole bash -c 'cd /tacos/code/test && ./test_unit.sh'
  - doxygen Doxyfile

deploy:
  provider: pages
  skip_cleanup: true
  local_dir: docs/html
  github_token: $GH_REPO_TOKEN
  on:
    branch: master
