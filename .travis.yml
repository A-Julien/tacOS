language: c
sudo: false

branches:
  only:
    - master

services:
  - docker
  
addons:
  apt:
    packages:
      - doxygen

before_install:
- ls -l
- docker pull jalaimo/nachos-build
- docker ps -a

script:
  - docker exec -it -v code:/nachos --name guacamole jalaimo/nachos-build bash -c 'cd /nachos && make && cd build && ./nachos-userprog -x halt > /proc/1/fd/1'
  - doxygen Doxyfile

deploy:
  provider: pages
  skip_cleanup: true
  local_dir: docs/html
  github_token: $GH_REPO_TOKEN
  on:
    branch: master
